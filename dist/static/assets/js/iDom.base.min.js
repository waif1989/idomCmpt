!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("incremental-dom")):"function"==typeof define&&define.amd?define(["incremental-dom"],e):t.IdomBase=e(t.IncrementalDOM)}(this,function(t){"use strict";function e(t,e){return 2!==arguments.length||e?(e||document).querySelector(t):null}e.exists=function(t,o){return 2===arguments.length?Boolean(e(t,o)):Boolean(e(t))},e.all=function(t,e){if(2===arguments.length&&!e)return[];if(!e||"function"==typeof e.querySelectorAll)return Array.apply(null,(e||document).querySelectorAll(t));var o,r,n,i;for(r=0;r<e.length;r++)if(o=e[r].querySelectorAll(t),i)for(n=0;n<o.length;n++)i.indexOf(o[n])<0&&i.push(o[n]);else i=Array.apply(null,o);return i};var o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable;var i,s,u=function(){try{if(!Object.assign)return!1;var t=new String("abc");if(t[5]="de","5"===Object.getOwnPropertyNames(t)[0])return!1;for(var e={},o=0;o<10;o++)e["_"+String.fromCharCode(o)]=o;if("0123456789"!==Object.getOwnPropertyNames(e).map(function(t){return e[t]}).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach(function(t){r[t]=t}),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(t){return!1}}()?Object.assign:function(t,e){for(var i,s,u=function(t){if(null==t)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(t)}(t),c=1;c<arguments.length;c++){for(var a in i=Object(arguments[c]))r.call(i,a)&&(u[a]=i[a]);if(o){s=o(i);for(var f=0;f<s.length;f++)n.call(i,s[f])&&(u[s[f]]=i[s[f]])}}return u};i=function(t){if("function"!=typeof t)throw new TypeError(t+" is not a function");return t},s=function(t){var e,o,r=document.createTextNode(""),n=0;return new t(function(){var t;if(e)o&&(e=o.concat(e));else{if(!o)return;e=o}if(o=e,e=null,"function"==typeof o)return t=o,o=null,void t();for(r.data=n=++n%2;o;)t=o.shift(),o.length||(o=null),t()}).observe(r,{characterData:!0}),function(t){i(t),e?"function"==typeof e?e=[e,t]:e.push(t):(e=t,r.data=n=++n%2)}};var c=function(){if("object"==typeof process&&process&&"function"==typeof process.nextTick)return process.nextTick;if("object"==typeof document&&document){if("function"==typeof MutationObserver)return s(MutationObserver);if("function"==typeof WebKitMutationObserver)return s(WebKitMutationObserver)}return"function"==typeof setImmediate?function(t){setImmediate(i(t))}:"function"==typeof setTimeout||"object"==typeof setTimeout?function(t){setTimeout(i(t),0)}:null}();return function(){function o(t,e){void 0===t&&(t={}),void 0===e&&(e="__defaultElmIdInside__");var r=this,n={},i={},s={},u=null;this.props={},this.state={},this.shadowProps={},this.afterWillMounted={state:!1},this.id="idom"+(1e3*Math.random()).toFixed(0),this._createRootElm(e),this._bindProps(t),this.$setProps=function(t){clearTimeout(u),u=setTimeout(function(){r.willReceiveProps(t)&&r.shouldUpdate(t,r.state)&&r._updateDataRender(t,r.state,!1),clearTimeout(u)})},o.isElm(this.rootElm)?c(function(){r.setState=r._bindState(s,n,i),r.willMounted(),r.afterWillMounted.state=!0,Object.defineProperty(r.afterWillMounted,"state",{writable:!1}),r._patch(r.rootElm),r.didMounted()}):c(function(){r.setState=r._bindState(s,n,i),r.willMounted(),r.afterWillMounted.state=!0,Object.defineProperty(r.afterWillMounted,"state",{writable:!1})})}return o.prototype.$destroy=function(){var t=this;return this.beforeDestroy()&&(t.rootElm.remove(),!0)&&this.afterDestroy()},o.prototype.$insert=function(e){var o=this;void 0===e&&(e=!1),this.rootElm=e||t.currentElement();var r=null;return t.patch(this.rootElm,function(){r=o.render()}),r},o.prototype._createRootElm=function(t){var o=null;if(!(o="string"==typeof t?e(t):t))throw new Error("Can't find the element node");this.rootElm=o},o.prototype._patch=function(e){var o=this;void 0===e&&(e=this.rootElm),t.patch(e,function(){o.render()})},o.prototype._bindState=function(t,e,o){for(var r=this,n=e,i=o,s=function(t){i[t]=n[t]=c.state[t],Object.defineProperty(c.state,t,{enumerable:!0,configurable:!1,get:function(){return i[t]},set:function(){}})},c=this,a=0,f=Object.keys(this.state);a<f.length;a++){s(f[a])}return function(e){void 0===e&&(e={});var o=t,s=null;if(r.afterWillMounted.state)u(o,e),clearTimeout(s),s=setTimeout(function(){var t=u(n,o);r.shouldUpdate(r.props,t)&&r._updateDataRender(r.props,t,!0,i),o={},clearTimeout(s)});else{var c=u(n,e);r._updateDataRender(r.props,c,!0,i)}}},o.prototype._bindProps=function(t){for(var e=this,r=null,n=o.recordSourceProp(t,this),i=window.__iDomInsSourcePropsThis__[n].cacheProps,s=function(o){e.props[o]=e.shadowProps[o]=i[o]=t[o],Object.defineProperty(t,o,{get:function(){return i[o]},set:function(e){i[o]=e,clearTimeout(r),r=setTimeout(function(){for(var e,o,i=window.__iDomInsSourcePropsThis__[n].ctx.length,s=0;s<i;s++)e=s,o=void 0,(o=window.__iDomInsSourcePropsThis__[n].ctx[e]).willReceiveProps(t)&&o.shouldUpdate(t,o.state)&&o._updateDataRender(t,o.state,!1);clearTimeout(r)})}}),Object.defineProperty(e.props,o,{enumerable:!0,configurable:!1,get:function(){return e.shadowProps[o]},set:function(){}})},u=0,c=Object.keys(t);u<c.length;u++){s(c[u])}},o.prototype._updateDataRender=function(t,e,o,r){void 0===o&&(o=!0);o?u(r,e):u(this.shadowProps,t),this.afterWillMounted.state&&this._patch(this.rootElm)},o.prototype.setState=function(){},o.prototype.render=function(){throw new Error("Render function must be implemented by subclass!")},o.prototype.willMounted=function(){},o.prototype.didMounted=function(){},o.prototype.willReceiveProps=function(t){return!0},o.prototype.shouldUpdate=function(t,e){return!0},o.prototype.beforeDestroy=function(){return!0},o.prototype.afterDestroy=function(){return!0},o.isElm=function(t){if("__defaultElmIdInside__"===t)return!1;if(isNaN(t)&&"number"==typeof t||"number"==typeof t||void 0===t||"boolean"==typeof t||"function"==typeof t||"symbol"==typeof t||Array.isArray(t))throw new Error("The elm must be string or document element!");return!0},o.recordSourceProp=function(t,e){if("object"==typeof window.__iDomInsSourcePropsThis__||Array.isArray(window.__iDomInsSourcePropsThis__)||(window.__iDomInsSourcePropsThis__=[]),"object"!=typeof window.__iDomInsSourceProps__||!Array.isArray(window.__iDomInsSourceProps__))return window.__iDomInsSourceProps__=[],window.__iDomInsSourceProps__.push(t),o.recordContext(0,e),0;for(var r=window.__iDomInsSourceProps__.length,n=!1,i=0;i<r;i++)if(t===window.__iDomInsSourceProps__[i])return n=!0,o.recordContext(i,e),i;if(!n){window.__iDomInsSourceProps__.push(t);i=window.__iDomInsSourceProps__.length-1;return o.recordContext(i,e),i}},o.recordContext=function(t,e){if("object"==typeof window.__iDomInsSourcePropsThis__[t]){for(var o=window.__iDomInsSourcePropsThis__[t].ctx.length,r=!1,n=0;n<o;n++)if(e===window.__iDomInsSourcePropsThis__[t].ctx[n]){r=!0;break}r||window.__iDomInsSourcePropsThis__[t].ctx.push(e)}else window.__iDomInsSourcePropsThis__[t]={},window.__iDomInsSourcePropsThis__[t].cacheProps={},window.__iDomInsSourcePropsThis__[t].ctx=[],window.__iDomInsSourcePropsThis__[t].ctx.push(e)},o}()});
